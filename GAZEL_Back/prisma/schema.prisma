// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum Status {
  ACTIVE
  INACTIVE
}

enum Role {
  USER
  ADMIN
}

enum CartStatus {
  ACTIVE
  CHECKED_OUT
  ABANDONED
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  COMPLETED
  CANCELLED
}

enum ShippingMethod {
  STANDARD
  CORREOS_CR
  UBER_FLASH
  PICKUP
}

enum PaymentMethod {
  CARD
  SINPE
  CASH
  CASH_ON_DELIVERY
}

enum PaymentStatus {
  PENDING
  APPROVED
  REJECTED
}

// Models
model User {
  id_user Int @id @default(autoincrement())
  full_name String
  email String @unique
  password_hash String
  phone String?
  avatar String?
  role Role @default(USER)
  status Status @default(ACTIVE)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  carts Cart[]
  orders Order[]
  
  @@map("users")
}

model Category {
  id_category Int @id @default(autoincrement())
  name String @unique
  description String?
  image_url String?
  status Status @default(ACTIVE)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  products Product[]

  @@map("categories")
}

model Product {
  id_product Int @id @default(autoincrement())
  name String
  description String?
  price Decimal @db.Decimal(10, 2)
  stock Int @default(0)
  image_url String?
  id_category Int
  status Status @default(ACTIVE)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  category Category @relation(fields: [id_category], references: [id_category], onDelete: Cascade)
  cart_items CartItem[]
  order_items OrderItem[]

  @@index([id_category])
  @@index([status])
  @@map("products")
}

model Cart {
  id_cart Int @id @default(autoincrement())
  id_user Int
  session_id String?
  status CartStatus @default(ACTIVE)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  user User @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  items CartItem[]

  @@index([id_user])
  @@map("cart")
}

model CartItem {
  id_cart_item Int @id @default(autoincrement())
  id_cart Int
  id_product Int
  quantity Int @default(1)
  unit_price Decimal @db.Decimal(10, 2)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  cart Cart @relation(fields: [id_cart], references: [id_cart], onDelete: Cascade)
  product Product @relation(fields: [id_product], references: [id_product], onDelete: Cascade)

  @@index([id_cart])
  @@index([id_product])
  @@map("cart_items")
}

model Order {
  id_order Int @id @default(autoincrement())
  id_user Int?
  order_date DateTime @default(now())
  total_amount Decimal @db.Decimal(10, 2)
  status OrderStatus @default(PENDING)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  user User? @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  items OrderItem[]
  shipping ShippingInfo?
  payments Payment[]

  @@index([id_user])
  @@index([order_date])
  @@map("orders")
}

model OrderItem {
  id_order_item Int @id @default(autoincrement())
  id_order Int
  id_product Int
  quantity Int @default(1)
  unit_price Decimal @db.Decimal(10, 2)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  order Order @relation(fields: [id_order], references: [id_order], onDelete: Cascade)
  product Product @relation(fields: [id_product], references: [id_product], onDelete: Cascade)

  @@index([id_order])
  @@index([id_product])
  @@map("order_items")
}

model ShippingInfo {
  id_shipping Int @id @default(autoincrement())
  id_order Int @unique
  full_name String
  identification String?
  phone String
  email String
  province String
  canton String
  district String
  address_details String
  delivery_notes String?
  shipping_method ShippingMethod
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  order Order @relation(fields: [id_order], references: [id_order], onDelete: Cascade)

  @@map("shipping_info")
}

model Payment {
  id_payment Int @id @default(autoincrement())
  id_order Int
  payment_method PaymentMethod
  payment_status PaymentStatus @default(PENDING)
  amount Decimal @db.Decimal(10, 2)
  payment_date DateTime @default(now())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  order Order @relation(fields: [id_order], references: [id_order], onDelete: Cascade)

  @@index([id_order])
  @@index([payment_status])
  @@map("payments")
}
